<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>E-Voting 2.0 | Election Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">

<main class="min-h-screen flex flex-col items-center p-4">

  <!-- ================= Celebration Canvas ================= -->
  <canvas id="confettiCanvas" class="fixed top-0 left-0 w-full h-full pointer-events-none"></canvas>

  <!-- ================= Results Header ================= -->
  <section class="w-full max-w-4xl bg-white rounded-xl shadow-md p-6 text-center mb-6">
    <h1 class="text-3xl font-bold text-green-600 mb-2">Election Results</h1>

    <p class="text-gray-600 mb-1">
      {{ election.name if election and election.name else "Election" }}
    </p>

    <p class="text-gray-700 font-semibold text-lg mt-2">
      Total Votes Cast: {{ total_votes if total_votes is not none else 0 }}
    </p>

    <!-- ================= RESULT STATUS ================= -->
    {% if is_draw %}
      <div class="mt-4 text-yellow-600 font-bold text-xl">
        âš–ï¸ Result: DRAW
      </div>
    {% elif winner %}
      <div class="mt-4 text-green-600 font-bold text-xl">
        ğŸ† Winner: {{ winner.name }} ({{ winner.votes }} votes)
      </div>
    {% else %}
      <div class="mt-4 text-gray-500 font-semibold text-lg">
        No votes cast
      </div>
    {% endif %}
  </section>

  <!-- ================= Candidates Results ================= -->
  <section class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-3 gap-6">

    {% for candidate in candidates %}
      {% set is_winner = winner and candidate._id == winner._id %}

      <div class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center
        {% if is_winner %} border-4 border-green-400 relative {% else %} border-2 border-gray-300 {% endif %}">

        {% if is_winner %}
          <div class="absolute top-0 -mt-6 bg-yellow-400 text-white px-4 py-1 rounded-full font-bold shadow-lg">
            Winner ğŸ†
          </div>
        {% endif %}

        <!-- Candidate Image (only if exists) -->
        {% if candidate.image_url %}
          <img
            src="{{ candidate.image_url }}"
            alt="{{ candidate.name }}"
            class="{% if is_winner %} w-32 h-32 {% else %} w-24 h-24 {% endif %} rounded-full mb-3"
          >
        {% endif %}

        <!-- Candidate Name -->
        <h2 class="text-xl font-bold text-center">
          {{ candidate.name if candidate.name else "Candidate" }}
        </h2>

        <p class="text-gray-500 text-sm mb-2 text-center">
          Party: {{ candidate.party_name if candidate.party_name else "Independent" }}
        </p>

        <!-- Votes -->
        <p class="text-gray-700 font-semibold mt-2">
          Votes: {{ candidate.votes if candidate.votes is not none else 0 }}
        </p>

        <p class="font-semibold text-gray-600">
          Percentage: {{ candidate.percentage if candidate.percentage is not none else 0 }}%
        </p>

      </div>
    {% endfor %}

  </section>

</main>

<!-- ================= Confetti Animation ================= -->
{% if winner and not is_draw %}
<script>
  const confettiCanvas = document.getElementById('confettiCanvas');
  const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

  myConfetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

  setInterval(() => {
    myConfetti({ particleCount: 50, spread: 50, origin: { y: 0.6 } });
  }, 2000);
</script>
{% endif %}

</body>
</html>